# NAV2消息有效载荷输入界面实现

## 概述

本界面实现了8种NAV2消息的有效载荷输入功能，每种消息都有专门的输入界面，支持结构化数据输入和实时预览。

## 支持的消息类型

### 1. NAV2-DOP (Message Class: 0x11, Message ID: 0x01)
- **有效载荷长度**: 24字节 (6个字段 × 4字节)
- **字段结构**:
  - `pDop`: 位置精度因子 (R4, 4字节)
  - `hDop`: 水平精度因子 (R4, 4字节)
  - `vDop`: 垂直精度因子 (R4, 4字节)
  - `nDop`: 北向精度因子 (R4, 4字节)
  - `eDop`: 东向精度因子 (R4, 4字节)
  - `tDop`: 时间精度因子 (R4, 4字节)

### 2. NAV2-SOL (Message Class: 0x11, Message ID: 0x02)
- **有效载荷长度**: 56字节
- **字段结构**: 包含位置、速度、时间等信息的14个字段
- **数据类型**: I4, U2, U1, R8, R4等

### 3. NAV2-PVH (Message Class: 0x11, Message ID: 0x03)
- **有效载荷长度**: 72字节
- **字段结构**: 包含位置、速度、航向等信息的18个字段
- **数据类型**: I4, U2, U1, R8, R4等

### 4. NAV2-SAT (Message Class: 0x11, Message ID: 0x04)
- **有效载荷长度**: 动态 (12 + 12×卫星数量 字节)
- **字段结构**:
  - **固定部分 (12字节)**:
    - `tow`: GPS时间, 周内时 (U4, 4字节)
    - `numViewTot`: 可见卫星总数 (U1, 1字节)
    - `numFixTot`: 用于定位的卫星总数 (U1, 1字节)
    - `res1`: 保留 (U1, 1字节)
    - `res2`: 保留 (U1, 1字节)
    - `res3`: 保留 (U4, 4字节)
  - **重复部分 (每颗卫星12字节)**:
    - `chn`: 跟踪通道号 (U1, 1字节)
    - `svid`: 卫星编号 (U1, 1字节)
    - `gnssid`: 卫星系统标识符 (U1, 1字节)
    - `flagx`: 卫星状态标志 (U1, 1字节)
    - `quality`: 信号质量 (U1, 1字节)
    - `cn0`: 载噪比 (U1, 1字节)
    - `sigid`: 卫星信号标识符 (U1, 1字节)
    - `elevation`: 卫星仰角 (U1, 1字节)
    - `azimuth`: 卫星方位角 (U2, 2字节)
    - `prresi`: 伪距误差 (I2, 2字节)

### 5. NAV2-TIMEUTC (Message Class: 0x11, Message ID: 0x05)
- **有效载荷长度**: 52字节
- **字段结构**: 包含时间、UTC信息等13个字段
- **数据类型**: R4, I4, I1, U1, U2等

### 6. NAV2-CLK (Message Class: 0x11, Message ID: 0x07)
- **有效载荷长度**: 32字节
- **字段结构**: 包含时钟信息等8个字段
- **数据类型**: U1, I4, R4等

### 7. NAV2-RVT (Message Class: 0x11, Message ID: 0x08)
- **有效载荷长度**: 52字节
- **字段结构**: 包含接收机时间信息等23个字段
- **数据类型**: I4, I2, U1, U2, R4等

### 8. NAV2-RTC (Message Class: 0x11, Message ID: 0x09)
- **有效载荷长度**: 32字节
- **字段结构**: 包含RTC时间信息等12个字段
- **数据类型**: I4, I2, I1, U1等

## 输入逻辑

### 十六进制输入规则
- 用户输入任意不超过规定位数的16进制数字
- 不输入默认该字段为全0
- 位数不全在封装时自动高位补0
- 输入不是16进制的数字或超出位数范围直接过滤，不报错

### 实时验证
- 输入时实时过滤无效字符
- 自动转换为大写
- 限制最大长度
- 失去焦点时进行最终验证

## 动态UI特性

### NAV2-SAT特殊使用方法
1. 选择消息类：`0x11 - NAV2`
2. 选择消息ID：`0x04 (SAT)`
3. 在`numViewTot`字段输入可见卫星总数（16进制，如05表示5颗卫星）
4. 系统立即生成对应数量的卫星信息输入框
5. 使用滚动轴浏览所有卫星字段
6. 为每颗卫星填写详细信息

### 滚动轴支持
- 固定字段使用紧凑布局
- 卫星字段使用滚动区域，最大高度450像素
- 支持垂直滚动，美观的滚动条样式
- 保持主窗口大小不变

## 数据包预览和统计

### 实时长度计算
- 根据选择的NAV2消息类型自动计算有效载荷长度
- 支持动态长度（如NAV2-SAT根据卫星数量）
- 实时显示字节数和十六进制表示

### 校验值计算
- 使用公式：`ckSum = (id << 24) + (class << 16) + len + payload_data_sum`
- 自动计算并显示4字节校验值
- 支持所有NAV2消息类型

### 完整数据包预览
- 十六进制格式显示，每行16字节
- 包含偏移量、十六进制数据和ASCII表示
- 显示数据包总长度和详细信息
- 支持所有NAV2消息的完整预览

## 界面优化

### 视觉设计
- 统一的颜色主题（蓝色系）
- 圆角边框和渐变背景
- 清晰的字段分组和标题
- 响应式布局和悬停效果

### 用户体验
- 智能输入验证和过滤
- 实时预览和统计更新
- 直观的字段标签和描述
- 支持键盘导航和快捷键

## 测试验证

### 测试脚本
- `test_all_nav2_messages.py`: 测试所有NAV2消息功能
- 支持单独测试每种消息类型
- 验证预览、长度统计和校验值计算

### 功能验证
- 消息类选择正确性
- 消息ID对应关系
- 有效载荷长度计算
- 校验值计算准确性
- 数据包预览完整性

## 技术实现

### 架构设计
- 模块化的消息处理系统
- 统一的输入验证框架
- 动态UI生成和管理
- 实时数据更新机制

### 性能优化
- 延迟加载和按需显示
- 高效的输入验证算法
- 优化的UI更新策略
- 内存友好的动态组件管理
