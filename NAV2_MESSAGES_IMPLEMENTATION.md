# NAV2消息有效载荷输入界面实现

## 概述

本实现为发送数据界面添加了七种NAV2消息的专用输入框，每种消息都有对应的字段输入界面，使用滚动区域来显示所有字段，保证窗口大小不变。

## 实现的消息类型

### 1. NAV2-DOP (消息类0x11, 消息ID 0x01)
- **描述**: 定位精度因子 (Positioning Accuracy Factor)
- **有效载荷长度**: 24字节
- **字段数量**: 6个
- **字段类型**: 全部为R4 (4字节浮点数)
- **字段列表**:
  - pDop (位置 DOP)
  - hDop (水平 DOP)
  - vDop (垂直 DOP)
  - nDop (北向 DOP)
  - eDop (东向 DOP)
  - tDop (时间 DOP)

### 2. NAV2-SOL (消息类0x11, 消息ID 0x02)
- **描述**: ECEF坐标系下的PVT导航信息
- **有效载荷长度**: 72字节
- **字段数量**: 25个
- **字段类型**: 混合类型 (I4, U2, U1, U4, R8, R4)
- **主要字段**:
  - tow (GPS时间, 周内时)
  - wn (GPS时间, 周数)
  - x, y, z (ECEF坐标系坐标)
  - vx, vy, vz (ECEF坐标系速度)
  - pAcc, sAcc (精度误差)
  - pDop (位置DOP)

### 3. NAV2-PVH (消息类0x11, 消息ID 0x03)
- **描述**: LLA格式位置,ENU格式速度
- **有效载荷长度**: 88字节
- **字段数量**: 30个
- **字段类型**: 混合类型 (I4, U2, U1, U4, R8, R4)
- **主要字段**:
  - tow (GPS时间, 周内时)
  - wn (GPS时间, 周数)
  - lon, lat (经度、纬度)
  - height (大地高度)
  - velE, velN, velU (ENU坐标系速度)
  - speed3D, speed2D (3D/2D速度)
  - heading (航向)
  - hAcc, vAcc, sAcc, cAcc (精度误差)

### 4. NAV2-TIMEUTC (消息类0x11, 消息ID 0x05)
- **描述**: UTC时间信息
- **有效载荷长度**: 20字节
- **字段数量**: 13个
- **字段类型**: 混合类型 (R4, I4, I1, U1, U2)
- **主要字段**:
  - tacc (接收机的时间误差估计值, ns)
  - subms (时间的毫秒误差值, ms)
  - subcs (时间的厘秒误差值, ms)
  - cs (时间的整数厘秒值, cs)
  - year, month, day (年、月、日)
  - hour, minute, second (时、分、秒)
  - tflagx (综合时间标志)
  - tsrc (时间的卫星系统来源)
  - leapsec (当前的闰秒值, s)

### 5. NAV2-CLK (消息类0x11, 消息ID 0x07)
- **描述**: 接收机时间偏差, 频率偏差
- **有效载荷长度**: 20字节
- **字段数量**: 8个
- **字段类型**: 混合类型 (U1, I4, R4)
- **主要字段**:
  - tsrc (卫星系统时间源)
  - res1 (保留字段)
  - towflag (接收机时间有效标志)
  - frqflag (接收机频率偏差有效标志)
  - clkbias (当前接收机时间偏差, ns)
  - dfxTcxo (接收机TCXO相对频率偏差, s/s)
  - tacc (接收机时间精度, ns)
  - facc (接收机频率精度, ppb)

### 6. NAV2-RVT (消息类0x11, 消息ID 0x08)
- **描述**: 接收机原始时间信息
- **有效载荷长度**: 52字节
- **字段数量**: 23个
- **字段类型**: 混合类型 (I4, I2, U1, U2, R4)
- **主要字段**:
  - rawTow (原始接收机时间, GPS周内时的整毫秒部分, ms)
  - rawTowSubms (原始接收机时间, GPS周内时的小数毫秒部分, ms)
  - dtuTow (原始接收机时间误差的整数毫秒, ms)
  - dtuTowSubms (原始接收机时间误差的小数毫秒, ms)
  - wn (原始接收机时间, GPS周数)
  - towflag (时间的有效标志)
  - wnflag (周数的有效标志)
  - ambflag (接收机整毫秒模糊度标志)
  - dtuflag (接收机时间误差的有效标志)
  - rvtRstTag (接收机时钟重置计数器)
  - rvtRst (接收机时钟调整量, ms)
  - tacc (接收机的时间精度, ns)
  - dtmeas (距上次定位测量的时间间隔, s)
  - dtsBds2Gps (BDS和GPS时间的整秒偏差, s)
  - dtsGln2Gps (GLONASS和GPS时间的整秒偏差, s)
  - dtsGal2Gps (GALILEO和GPS时间的整秒偏差, s)
  - dtsIrn2Gps (IRNSS和GPS时间的整秒偏差, s)

### 7. NAV2-RTC (消息类0x11, 消息ID 0x09)
- **描述**: 接收机 RTC 时间信息
- **有效载荷长度**: 32字节
- **字段数量**: 12个
- **字段类型**: 混合类型 (I4, I2, I1, U1)
- **主要字段**:
  - dtRtcTow (RTC 时间误差,整数毫秒部分, ms)
  - dtRtcTowSubms (RTC 时间误差,小数毫秒部分, ms)
  - rtcTow (RTC 时间的整数毫秒, ms)
  - rtcTowSubms (RTC 时间的小数毫秒, ms)
  - wn (RTC 时间,GPS 周数)
  - leapSec (GPS 闰秒, s)
  - dfRtc (RTC 晶振频偏, Hz)
  - dfRtcFlag (RTC 晶振频偏的计算有效标志)
  - rtcSrc (RTC 时间校准的数据源)

## 输入逻辑特性

### 1. 输入验证
- 只允许输入有效的16进制字符 (0-9, A-F, a-f)
- 无效字符会被自动过滤，不显示错误提示
- 输入长度限制根据字段类型自动设置

### 2. 自动补零
- 用户输入不足位数时，在封装时自动高位补零
- 输入框内不显示补零，保持用户输入的原始内容
- 空字段默认为全0

### 3. 数据类型支持
- **I4**: 4字节有符号整数 (最大8位16进制)
- **U4**: 4字节无符号整数 (最大8位16进制)
- **U2**: 2字节无符号整数 (最大4位16进制)
- **U1**: 1字节无符号整数 (最大2位16进制)
- **R4**: 4字节浮点数 (最大8位16进制)
- **R8**: 8字节浮点数 (最大16位16进制)

### 4. 界面布局
- 使用滚动区域显示所有字段，保证窗口大小不变
- 每行显示2个字段，标签和输入框并排
- 不同消息类型使用不同颜色主题区分
- 自动显示/隐藏对应的输入界面

## 使用方法

### 1. 选择消息类型
- 在"消息类"下拉框中选择"0x11 - NAV2"
- 在"消息ID"下拉框中选择对应的消息类型:
  - 0x01: NAV2-DOP
  - 0x02: NAV2-SOL
  - 0x03: NAV2-PVH
  - 0x05: NAV2-TIMEUTC
  - 0x07: NAV2-CLK
  - 0x08: NAV2-RVT
  - 0x09: NAV2-RTC

### 2. 输入字段数据
- 每个字段都有对应的输入框
- 输入16进制数据，留空默认为0
- 系统会自动验证输入格式
- 支持0x前缀的16进制格式

### 3. 自动计算
- 有效载荷长度自动计算
- 校验值自动计算
- 完整数据包自动生成

## 技术实现

### 1. 信号连接
- `textChanged`: 实时验证输入
- `editingFinished`: 完成编辑时更新预览
- 自动更新数据包预览

### 2. 数据解析
- 根据字段类型自动选择解析方法
- 支持不同字节长度的数据类型
- 小端序字节序处理

### 3. 错误处理
- 静默模式处理，避免频繁弹窗
- 输入验证失败时提供友好提示
- 异常情况下的优雅降级

## 扩展性

该实现具有良好的扩展性，可以轻松添加新的NAV2消息类型：

1. 定义新的字段信息数组
2. 创建对应的输入框界面
3. 添加解析方法
4. 在可见性检查中添加新类型

## 注意事项

1. 所有字段输入框都支持留空，留空时自动使用默认值0
2. 输入长度限制根据数据类型自动设置，超出长度会被截断
3. 滚动区域的最大高度设置为300像素，确保界面美观
4. 不同消息类型使用不同颜色主题，便于用户识别
